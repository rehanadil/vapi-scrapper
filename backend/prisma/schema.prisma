generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "linux-arm64-openssl-1.1.x", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int         @id @default(autoincrement())
  name       String
  email      String      @unique
  password   String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  role       String      @default("customer")
  assistants Assistant[]

  @@map("users")
}

model Assistant {
  id        Int      @id @default(autoincrement())
  name      String
  modelType String
  vapiId    String?  @map("vapi_id")
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  metrics   Metric[]

  @@map("assistants")
}

model Metric {
  assistantId                        Int
  date                               DateTime
  totalCallDuration                  Float     @default(0)
  outboundCallCount                  Int       @default(0)
  webCallCount                       Int       @default(0)
  failedCustomerEndedCallCount       Int       @default(0)
  failedAssistantEndedCallCount      Int       @default(0)
  failedCustomerNoAnswerCallCount    Int       @default(0)
  failedExceedDurationCallCount      Int       @default(0)
  failedCustomerBusyCallCount        Int       @default(0)
  failedSilenceTimeoutCallCount      Int       @default(0)
  failedOtherCallCount               Int       @default(0)
  totalMinutes                       Float     @default(0)
  avgCallCost                        Float     @default(0)
  totalCost                          Float     @default(0)
  totalSpent                         Float     @default(0)
  successEvaluationTrue              Int       @default(0)
  successEvaluationFalse             Int       @default(0)
  successEvaluationNull              Int       @default(0)
  createdAt                          DateTime  @default(now())
  assistant                          Assistant @relation(fields: [assistantId], references: [id], onDelete: Cascade)

  @@id([assistantId, date])
  @@index([date])
  @@map("metrics")
}
